# ポートフォリオサイト詳細設計書

## 1 システム概要

- **目的:** 自身のスキル、成果物（GitHub）、発信（Zenn）を一元管理し、技術力をアピールする。
- **主要機能:**
  - GitHub リポジトリ（Pinned Items / Star 数）の自動表示
  - Zenn 記事（最新記事）の自動表示
  - 静的サイト生成（SSG）による高速表示
  - 日次自動更新（毎日深夜に最新データを取得して再ビルド）

## 2 アーキテクチャ構成

「ビルド時に外部データを取得し、HTML として固める」構成です。これにより、クライアントサイドでの API コールを排除し、爆速な読み込みと API 制限回避を実現します。

### 構成要素

| レイヤー         | 技術スタック         | 役割                                                       |
| :--------------- | :------------------- | :--------------------------------------------------------- |
| **Framework**    | **Astro v5**         | サイト全体の骨組み、ルーティング、SSG 実行                 |
| **UI Component** | **React**            | アニメーションや複雑なインタラクションが必要な箇所のみ使用 |
| **Styling**      | **Tailwind CSS**     | ユーティリティファーストなスタイリング                     |
| **Data Fetch**   | **GraphQL / RSS**    | GitHub API (GraphQL), Zenn (RSS Feed)                      |
| **Hosting**      | **Cloudflare Pages** | 静的ホスティング、CDN                                      |
| **CI/CD**        | **GitHub Actions**   | コード変更時および\*\*Cron（定期実行）\*\*による自動ビルド |

---

## 3 ディレクトリ構造設計

Astro の標準構成をベースに、データ取得ロジックを分離して管理しやすくします。

```text
/
├── public/              # 静的ファイル（favicon, ogp画像など）
├── src/
│   ├── components/      # UIコンポーネント
│   │   ├── Card.astro       # 汎用カード（Astroコンポーネント推奨）
│   │   ├── Header.astro
│   │   ├── Footer.astro
│   │   └── ReactCounter.tsx # Reactが必要な動的パーツ（例）
│   ├── layouts/         # ページレイアウト
│   │   └── BaseLayout.astro
│   ├── lib/             # データ取得ロジック（ここが重要）
│   │   ├── github.ts    # GitHub GraphQL API叩く君
│   │   └── zenn.ts      # RSS Parser叩く君
│   ├── pages/           # ルーティング
│   │   └── index.astro  # トップページ（ここでデータをawaitする）
│   └── types/           # TypeScript型定義
│       └── index.ts     # Repository型, Article型など
├── astro.config.mjs     # Astro設定
├── tailwind.config.mjs  # Tailwind設定
└── package.json
```

---

## 4 データ取得設計 (Data Fetching Strategy)

ビルド時（`astro build`実行時）にサーバーサイドで実行される処理です。

### 4.1. GitHub データ取得 (`src/lib/github.ts`)

REST API ではなく**GraphQL API**を使用します（必要なデータだけを 1 回のリクエストで取得できるため）。

- **Endpoint:** `https://api.github.com/graphql`
- **Auth:** 環境変数 `GITHUB_TOKEN` を使用
- **取得データ:**
  - Pinned Repositories (名前, 説明, URL, Star 数, 言語, 言語色)
  - (オプション) Contribution Graph のデータ
- **クエリイメージ:**
  ```graphql
  query {
    viewer {
      pinnedItems(first: 6, types: REPOSITORY) {
        nodes { ... }
      }
    }
  }
  ```

### 4.2. Zenn データ取得 (`src/lib/zenn.ts`)

API キー不要の**RSS フィード**を使用します。

- **Endpoint:** `https://zenn.dev/kinn00kinn/feed`
- **Library:** `rss-parser`
- **取得データ:** 記事タイトル, URL, 公開日, (あれば)サムネイル
- **整形処理:** 日付フォーマットを見やすい形（YYYY.MM.DD）に変換する処理を含める。

---

## 5 UI/UX デザイン方針

「情報系学生」らしさを出すため、シンプルかつグリッドを意識したデザイン（Bento Grid 風）を推奨します。

- **メインビジュアル:** 名前、肩書き（KOSEN Advanced Course Student）、SNS リンク。
- **Projects セクション (GitHub):**
  - カード型レイアウト。
  - 言語ごとの Color Circle を表示（例: Python は青, TypeScript は青など GitHub の色に合わせる）。
- **Articles セクション (Zenn):**
  - リスト形式またはカード形式。
  - 「New」バッジなどを直近の記事に付与。

---

## 6 自動化・デプロイ設計 (CI/CD)

ここが「LAPRAS 風」を実現する肝です。

### 6.1. 環境変数の設定

セキュリティのため、トークンはコードに含めず環境変数で管理します。

1.  **ローカル開発:** `.env` ファイル
    ```properties
    GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxx
    ```
2.  **Cloudflare Pages:** 設定画面の「Environment variables」に同値を設定。

### 6.2. 自動更新ワークフロー (`.github/workflows/deploy.yml`)

Cloudflare Pages は GitHub 連携だけで自動デプロイできますが、\*\*「コード変更がない日もデータを更新したい」\*\*ため、Deploy Hook を使用します。

**手順:**

1.  Cloudflare Pages 管理画面 \> Settings \> Builds & deployments \> Deploy hooks で Hook を作成（URL が発行される）。
2.  GitHub Repo \> Settings \> Secrets and variables \> Actions に `CLOUDFLARE_DEPLOY_HOOK` として URL を保存。
3.  以下の YAML を設定。

<!-- end list -->

```yaml
name: Scheduled Build

on:
  schedule:
    # 毎日 日本時間 午前9時 (UTC 0:00)
    - cron: "0 0 * * *"
  workflow_dispatch: # 手動実行ボタン

jobs:
  trigger-build:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Cloudflare Pages
        run: curl -X POST "${{ secrets.CLOUDFLARE_DEPLOY_HOOK_URL }}"
```

※ Note: Cloudflare Pages の自動ビルド（Push 時）とは別に、この Cron ジョブが Hook を叩くことで、コード変更がなくても毎日サイトが再ビルドされ、最新の Zenn 記事や Star 数が反映されます。

---

## 7 実装ステップ（Next Action）

この設計書に基づいて、以下の順序で開発を進めるのが最も効率的です。

1.  **プロジェクト初期化:** `npm create astro@latest` (React, Tailwind を選択)
2.  **GitHub Token 取得:** GitHub 設定から Personal Access Token (Classic)を取得（repo scope のみで OK）。
3.  **データ取得実装:** `src/lib/` にスクリプトを書き、`console.log` でデータが取れるか確認。
4.  **UI 実装:** 取得したデータを Astro ファイルで表示。
5.  **デプロイ:** GitHub に Push し、Cloudflare Pages と連携。
6.  **自動化設定:** Deploy Hook の設定と GitHub Actions の追加。
